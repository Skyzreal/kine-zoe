<div class="confirmation-container" *ngIf="!formSubmitted">
  <div class="bg-shape shape1"></div>
  <div class="bg-shape shape2"></div>

  <h1>Information</h1>
  <p class="subtitle">Entrez vos informations</p>

  <form class="info-form" (ngSubmit)="submitForm()" #userForm="ngForm">
    <p class="form-note">Tous les champs sont obligatoires</p>

    <label>Prénom *</label>
    <input
      name="prenom"
      [(ngModel)]="clientInfo.prenom"
      required
      minlength="2"
      #prenom="ngModel"
      placeholder="Votre prénom"
      [class.invalid]="prenom.invalid && (prenom.dirty || prenom.touched)"
    />
    <div class="error-text" *ngIf="prenom.invalid && (prenom.dirty || prenom.touched)">
      <span *ngIf="prenom.errors?.['required']">Le prénom est obligatoire</span>
      <span *ngIf="prenom.errors?.['minlength']">Le prénom doit contenir au moins 2 caractères</span>
    </div>

    <label>Nom *</label>
    <input
      name="nom"
      [(ngModel)]="clientInfo.nom"
      required
      minlength="2"
      #nom="ngModel"
      placeholder="Votre nom"
      [class.invalid]="nom.invalid && (nom.dirty || nom.touched)"
    />
    <div class="error-text" *ngIf="nom.invalid && (nom.dirty || nom.touched)">
      <span *ngIf="nom.errors?.['required']">Le nom est obligatoire</span>
      <span *ngIf="nom.errors?.['minlength']">Le nom doit contenir au moins 2 caractères</span>
    </div>

    <label>Adresse *</label>
    <input
      name="adresse"
      [(ngModel)]="clientInfo.adresse"
      required
      minlength="5"
      #adresse="ngModel"
      placeholder="123 Rue Exemple, Montréal, QC"
      [class.invalid]="adresse.invalid && (adresse.dirty || adresse.touched)"
    />
    <div class="error-text" *ngIf="adresse.invalid && (adresse.dirty || adresse.touched)">
      <span *ngIf="adresse.errors?.['required']">L'adresse est obligatoire</span>
      <span *ngIf="adresse.errors?.['minlength']">L'adresse doit contenir au moins 5 caractères</span>
    </div>

    <label>Date de naissance *</label>
    <input
      name="dateNaissance"
      type="date"
      [(ngModel)]="clientInfo.dateNaissance"
      required
      #dateNaissance="ngModel"
      [class.invalid]="dateNaissance.invalid && (dateNaissance.dirty || dateNaissance.touched)"
    />
    <div class="error-text" *ngIf="dateNaissance.invalid && (dateNaissance.dirty || dateNaissance.touched)">
      <span *ngIf="dateNaissance.errors?.['required']">La date de naissance est obligatoire</span>
    </div>

    <label>Numéro de téléphone *</label>
    <input
      name="phone"
      type="tel"
      [(ngModel)]="clientInfo.phone"
      required
      pattern="[\(\)\d\s\-\+]+"
      minlength="10"
      #phone="ngModel"
      placeholder="(514) 123-4567"
      [class.invalid]="phone.invalid && (phone.dirty || phone.touched)"
    />
    <div class="error-text" *ngIf="phone.invalid && (phone.dirty || phone.touched)">
      <span *ngIf="phone.errors?.['required']">Le numéro de téléphone est obligatoire</span>
      <span *ngIf="phone.errors?.['pattern']">Format de téléphone invalide</span>
      <span *ngIf="phone.errors?.['minlength']">Le numéro doit contenir au moins 10 chiffres</span>
    </div>

    <label>E-mail *</label>
    <input
      name="email"
      type="email"
      [(ngModel)]="clientInfo.email"
      required
      email
      #emailField="ngModel"
      placeholder="votre@email.com"
      [class.invalid]="emailField.invalid && (emailField.dirty || emailField.touched)"
    />
    <div class="error-text" *ngIf="emailField.invalid && (emailField.dirty || emailField.touched)">
      <span *ngIf="emailField.errors?.['required']">L'e-mail est obligatoire</span>
      <span *ngIf="emailField.errors?.['email']">L'e-mail doit être valide</span>
    </div>

    <!-- Display selected service and time slot -->
    <div class="booking-summary">
      <h3>Résumé de votre réservation</h3>
      <p><strong>Service:</strong> {{ clientInfo.service }}</p>
      <p><strong>Nombre de créneaux:</strong> {{ selectedSlots.length }}</p>

      <div class="slots-list">
        <div *ngFor="let slot of selectedSlots; let i = index" class="slot-item">
          <span class="slot-number">{{ i + 1 }}.</span>
          <span class="slot-details">{{ getFormattedTimeSlot(slot) }}</span>
        </div>
      </div>

      <div class="pricing-details" *ngIf="!isFreeBooking()">
        <p><strong>Prix par créneau:</strong> {{ getSinglePrice() / 100 | currency:'CAD':'symbol':'1.2-2' }}</p>
        <p class="total-price"><strong>Prix total:</strong> {{ getTotalPrice() / 100 | currency:'CAD':'symbol':'1.2-2' }}</p>
      </div>

      <div class="pricing-details free-booking" *ngIf="isFreeBooking()">
        <p class="free-price">✨ <strong>Session gratuite</strong> ✨</p>
        <p class="free-note">Aucun paiement requis</p>
      </div>
    </div>

    <!-- Error message -->
    <div class="error-message" *ngIf="paymentError">
      {{ paymentError }}
    </div>

    <button
      type="submit"
      [disabled]="!userForm.valid || isProcessingPayment"
      class="submit-btn"
      [class.free-booking-btn]="isFreeBooking()"
    >
      <span *ngIf="!isProcessingPayment && !isFreeBooking()">Procéder au paiement</span>
      <span *ngIf="!isProcessingPayment && isFreeBooking()">Confirmer la réservation gratuite</span>
      <span *ngIf="isProcessingPayment">Traitement en cours...</span>
    </button>
  </form>
</div>

<div class="thank-you" *ngIf="formSubmitted">
  <h2>Merci pour votre réservation !</h2>
  <p>Votre paiement a été traité avec succès.</p>
  <p>Vous recevrez un courriel de confirmation sous peu.</p>

  <div class="confirmation-details">
    <h3>Détails de votre rendez-vous</h3>
    <p><strong>Service:</strong> {{ clientInfo.service }}</p>
    <p><strong>Date et heure:</strong> {{ clientInfo.timeSlot }}</p>
    <p><strong>Client:</strong> {{ clientInfo.prenom }} {{ clientInfo.nom }}</p>
  </div>
</div>
