<div class="reserver-container">
  <div class="bg-shape shape1"></div>
  <div class="bg-shape shape2"></div>

  <h1>Réservez votre rendez-vous pour
    <p><strong>Service:</strong> {{ selectedService || 'Non spécifié' }}</p>
  </h1>

  <p class="subtitle">Choisissez une heure et une date qui vous convient</p>

  <!-- Loading state -->
  <div *ngIf="loading" class="loading-message">
    <p>Chargement des créneaux disponibles...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadAvailability()" class="retry-btn">Réessayer</button>
  </div>

  <!-- Main content when data is loaded -->
  <div *ngIf="!loading && !error" class="reserver-grid">

    <!-- Available dates -->
    <div class="calendar">
      <h3>Créneaux disponibles</h3>
      <div *ngIf="freeEvents.length === 0" class="no-slots">
        <p>Aucun créneau libre disponible dans les 7 prochains jours.</p>
      </div>
      <div *ngIf="freeEvents.length > 0" class="calendar-grid">
        <div
          *ngFor="let slot of freeEvents; let i = index"
          class="day"
          [class.selected]="selectedSlotIndex === i"
          (click)="selectSlot(i)">
          {{ getDateOnly(slot.date) }}
        </div>
      </div>
    </div>

    <!-- Time slots for selected date -->
    <div class="time-slots" *ngIf="selectedSlotIndex !== null">
      <h3>{{ getFullDate(freeEvents[selectedSlotIndex].date) }}</h3>
      <button
        class="time-btn selected"
        (click)="selectTimeSlot()">
        {{ getTimeRange(freeEvents[selectedSlotIndex]) }}
      </button>
    </div>

    <!-- Placeholder when no date selected -->
    <div class="time-slots" *ngIf="selectedSlotIndex === null && freeEvents.length > 0">
      <h3>Sélectionnez une date</h3>
      <p>Choisissez une date pour voir les heures disponibles</p>
    </div>
  </div>

  <!-- Summary box -->
  <div class="summary-box" *ngIf="selectedSlotIndex !== null">
    <h3>Votre réservation</h3>
    <p><strong>Service:</strong> {{ selectedService || 'Non spécifié' }}</p>
    <p><strong>Date:</strong> {{ getFullDate(freeEvents[selectedSlotIndex].date) }}</p>
    <p><strong>Heure:</strong> {{ getTimeRange(freeEvents[selectedSlotIndex]) }}</p>
    <p><strong>$132,22</strong></p>
    <button class="confirm-btn" [routerLink]="['/confirmation-info']">
      Confirmer la réservation
    </button>
  </div>
</div>
